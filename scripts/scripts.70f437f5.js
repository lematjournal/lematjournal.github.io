!function(a){"use strict";a.module("lematClient",["lematClient.admin","lematClient.common","lematClient.core","lematClient.services","ui.router"]).config(["$locationProvider",function(a){a.html5Mode({enabled:!1}).hashPrefix("!")}]),a.module("lematClient.common.constants",[]),a.module("lematClient.common.directives",["ngTouch","ui.bootstrap","duScroll","wysiwyg.module","angularUtils.directives.dirPagination","angularUtils.directives.dirDisqus","angucomplete-alt","ngTagsInput","validation.match","akoenig.deckgrid","bootstrapColumnsSameHeight","socialLinks","youtube-embed","slugifier"]),a.module("lematClient.common.factories",[]),a.module("lematClient.common.filters",["angular.filter"]),a.module("lematClient.common",["lematClient.common.constants","lematClient.common.directives","lematClient.common.factories","lematClient.common.filters"]),a.module("lematClient.admin",[]),a.module("lematClient.admin.entries",[]),a.module("lematClient.admin.images",[]),a.module("lematClient.admin.issues",[]),a.module("lematClient.admin.mail",[]),a.module("lematClient.admin.posts",[]),a.module("lematClient.admin.submissions",[]),a.module("lematClient.admin.users",[]),a.module("lematClient.admin",["lematClient.admin.entries","lematClient.admin.images","lematClient.admin.issues","lematClient.admin.mail","lematClient.admin.posts","lematClient.admin.submissions","lematClient.admin.users"]),a.module("lematClient.core",[]),a.module("lematClient.core.editors",[]),a.module("lematClient.core.entries",[]),a.module("lematClient.core.issues",[]),a.module("lematClient.core.layout.footer",[]),a.module("lematClient.core.layout.header",[]),a.module("lematClient.core.layout.logo",[]),a.module("lematClient.core.layout.nav",[]),a.module("lematClient.core.layout",["lematClient.core.layout.header","lematClient.core.layout.footer","lematClient.core.layout.nav","lematClient.core.layout.logo"]),a.module("lematClient.core.login",[]),a.module("lematClient.core.posts",[]),a.module("lematClient.core.profile",[]),a.module("lematClient.core",["lematClient.core.editors","lematClient.core.entries","lematClient.core.issues","lematClient.core.layout","lematClient.core.login","lematClient.core.posts","lematClient.core.profile"]),a.module("lematClient.services",["ngCookies","ngSanitize","ng.deviceDetector"])}(angular),angular.module("lematClient.common.constants").constant("ServerUrl","https://lematjournal.herokuapp.com"),function(a){"use strict";function b(a,b,c,d,e,f){var g=this;g.identifier=b.entry,g.getEntries=function(){f.getEntries().then(function(){g.entries=f.entries})},g.getEntry=function(){f.getEntry(b.entry).then(function(){g.entry=f.entry})},g.upsertEntry=function(a){e.isAuthenticated()&&(f.upsertEntry(a),c.path("/admin/entries"))},g.deleteEntry=function(a){e.isAuthenticated()&&(f.deleteEntry(a),c.path("/admin/entries"))},a.openUserModal=function(){a.$modalInstance=d.open({scope:a,templateUrl:"scripts/admin/users/users.create.modal/users.create.modal.html",controller:"UsersController",size:"lg"})},a.$on("selectedUser",function(a,b){g.entry.user_id=b.id})}a.module("lematClient.admin.entries").controller("EntriesAdminController",b),b.$inject=["$scope","$stateParams","$location","$uibModal","AuthFactory","EntryFactory"]}(angular),function(a){"use strict";function b(a,b,c,d,e){function f(a){for(var b=0;b<g.images.length;b++)if(g.images[b].id===a)return b}var g=this;a.isAdmin=function(){return c.isAdmin()},g.getImages=function(){e.getImages().then(function(){g.images=e.images})},g.deleteImage=function(a){d.deleteFile(a.image_url).then(function(){e.deleteImage(a.id).then(function(){g.images.splice(f(a.id),1)},function(){console.log("error")})})},a.pageChangeHandler=function(){},a.currentPage=1}a.module("lematClient.admin.images").controller("ImagesController",b),b.$inject=["$scope","$q","AuthFactory","AS3Factory","ImagesFactory"]}(angular),angular.module("lematClient.admin.images").factory("ImagesFactory",["$http","ServerUrl",function(a,b){var c=[],d={},e=function(){return a.get(b+"/content/images/").then(function(a){angular.copy(a.data,c)})},f=function(c){return a["delete"](b+"/content/images/"+c).then(function(){})},g=function(c){console.log("input image",c);var d={image:{image_url:c.image_url,user_id:c.user_id}};return console.log("params",d),a.post(b+"/content/images/",d).then(function(a){angular.copy(a.data,c)},function(a){console.log("error: ",a)})};return{getImages:e,uploadImage:g,deleteImage:f,images:c,image:d}}]),function(a){"use strict";function b(b,c,d,e,f,g,h,i,j,k){function l(){b.$modalInstance=f.open({scope:b,templateUrl:"scripts/admin/issues/issues.cover.modal/issues.cover.modal.html",controller:"IssuesCoverModalController",controllerAs:"issuesCoverModalCtrl",windowClass:"app-modal-window",size:"lg"}),b.$modalInstance.result.then(function(a){m.issue.image_url=a,m.upsertIssue(m.issue)})}var m=this;m.image={},m.getIssues=function(){i.getIssues().then(function(){m.issues=i.issues})},m.getIssue=function(){i.getIssue(d.id).then(function(){m.issue=i.issue})},m.getPieces=function(){i.getIssue(d.id).then(function(){m.pieces=i.pieces})},m.upsertIssue=function(a){g.isAuthenticated()&&(i.upsertIssue(a),i.getIssues())},m.deleteIssue=function(a){g.isAuthenticated()&&i.deletePost(a)},m.upsertPiece=function(a){g.isAuthenticated()&&k.upsertPiece(a,d.id).then(function(){m.getIssue(d.id),m.getPieces()})},m.deletePiece=function(){g.isAuthenticated()&&k.deletePiece(b.piece)},m.updatePieces=function(){a.forEach(b.issue.pieces,function(a){m.upsertPiece(a)})},b.uploadImage=function(){var a={user_id:c.userId,image_url:m.issue.image_url};j.uploadImage(a)},m.openImageManager=l}a.module("lematClient.admin.issues").controller("IssuesAdminController",b),b.$inject=["$scope","$rootScope","$stateParams","$location","$uibModal","AuthFactory","AS3Factory","IssuesFactory","ImagesFactory","PiecesFactory"]}(angular),function(a){"use strict";function b(a,b,c,d){var e=this;e.getImages=function(){d.getImages().then(function(){e.images=d.images})},e.setIssueImage=function(a){e.image_url=a,toastr.info("Issue cover image selected","Selected")},e.uploadImage=function(){var a={user_id:b.userId,image_url:e.issue.image_url};d.uploadImage(a).then(function(){d.getImages()})},a.ok=function(){c.close(e.image_url)},a.cancel=function(){c.dismiss("cancel")}}a.module("lematClient.admin.issues").controller("IssuesCoverModalController",b),b.$inject=["$scope","$rootScope","$modalInstance","ImagesFactory"]}(angular),function(a){"use strict";function b(a,b,c){var d=this;d.getEmails=function(){c.getEmails().then(function(){d.emails=c.emails})},d.getEmail=function(){c.getEmail(b.email).then(function(){d.email=c.email})}}a.module("lematClient.admin.mail").controller("MailController",b),b.$inject=["$scope","$stateParams","EmailFactory"]}(angular),angular.module("lematClient.admin.mail").factory("EmailFactory",["$http","ServerUrl",function(a,b){var c=[],d={},e=function(){return a.get(b+"/emails/").then(function(a){angular.copy(a.data,c)})},f=function(c){return a.get(b+"/emails/"+c).then(function(a){angular.copy(a.data,d)})};return{getEmails:e,getEmail:f,emails:c,email:d}}]),function(a){"use strict";function b(a,b,c,d,e,f,g){function h(a){for(var b=0;b<i.piece.users.length;b++)if(i.piece.users[b].id===a)return i.piece.users[b]}var i=this;i.piece={users:[]},i.getPiece=function(){g.getPiece(b.id,b.piece),i.piece=g.piece},i.upsertPiece=function(a){e.isAuthenticated()&&g.upsertPiece(a,b.id).then(function(){f.getIssue(b.id),i.getPiece()})},i.deletePiece=function(){e.isAuthenticated()&&g.deletePiece(i.piece)},i.removeUser=function(a){i.piece.users.splice(h(a),1)},a.openUserModal=function(){a.$modalInstance=d.open({scope:a,templateUrl:"views/modals/user-create.html",controller:"UsersController",size:"lg"})}}a.module("lematClient.admin.issues").controller("PiecesAdminController",b),b.$inject=["$scope","$stateParams","$location","$uibModal","AuthFactory","IssuesFactory","PiecesFactory"]}(angular),function(a){"use strict";function b(b,c,d,e,f,g,h){function i(a){for(var b=0;b<j.posts.length;b++)if(j.posts[b].id===a)return j.posts[b].id}var j=this;j.getPost=function(){h.getPost(d.post).then(function(){j.post=h.post})},j.getPosts=function(){h.getPosts().then(function(){j.posts=h.posts})},j.resetPost=function(){a.copy({},j.post)},j.getUsers=function(){g.getUsers().then(function(){j.users=g.users})},j.upsertPost=function(a){f.isAuthenticated()&&(h.upsertPost(a),c.path("/admin/posts"),$route.reload())},j.deletePost=function(a){f.isAuthenticated()&&(h.deletePost(a),j.posts.splice(i(a),1))},b.openUserModal=function(){b.$modalInstance=e.open({scope:b,templateUrl:"views/admin/modals/user-create.html",controller:"UserController",size:"lg"})},b.ok=function(){b.$modalInstance.close()},b.cancel=function(){b.$modalInstance.dismiss("cancel")},b.$on("selectedUser",function(a,b){j.post.user_id=b.id}),j.getTags=function(){h.getTags().then(function(){j.tags=h.tags})}}a.module("lematClient.admin.posts").controller("PostsAdminController",b),b.$inject=["$scope","$location","$stateParams","$uibModal","AuthFactory","UsersFactory","PostsFactory"]}(angular),function(a){"use strict";function b(b,c,d,e,f,g,h){function i(a){b.$modalInstance=d.open({templateUrl:"views/admin/modals/submission-vote.html",controller:"SubmissionModalController",controllerAs:"vm",size:"lg",resolve:{submission:function(){return j.submissions[a]}}}),b.$modalInstance.result.then(function(b){j.submissions[a]=b,g.updateVotes(j.submissions[a])})}var j=this;j.getEditors=function(){return h.getEditors().then(function(){j.editors=h.editors})},j.getNumber=function(a){return new Array(a)},j.getSubmissions=function(){g.getSubmissions().then(function(){j.submissions=g.submissions})},j.getSubmission=function(){g.getSubmission(f.submission).then(function(){j.submission=g.submission})},j.editors=function(a){return a.role.match(/^(admin|editor)$/)},j.querySubmission=function(b,c){var d={};return a.forEach(j.submissions[b].votes_array,function(a){d=a.user_id===c&&a.vote?!0:!1}),d},j.submissionModal=i}a.module("lematClient.admin.submissions").controller("SubmissionsController",b),b.$inject=["$scope","$filter","$uibModal","$rootScope","$stateParams","SubFactory","UsersFactory"]}(angular),angular.module("lematClient.admin.submissions").factory("SubFactory",["$http","ServerUrl",function(a,b){var c={},d=[],e={},f=function(){return a.get(b+"/submissions/").then(function(a){angular.copy(a.data,d)})},g=function(c){return a.get(b+"/submissions/"+c).then(function(a){angular.copy(a.data,e)})},h=function(d){var e={comment:d};return a.post(b+"/submissions/comments",e).then(function(a){angular.copy(a.data,c),console.log("comment: ",c)})},i=function(c){console.log("input: ",c);var d={submission:{votes:c.votes,votes_array:c.votes_array}};return a.patch(b+"/submissions/"+c.id,d).then(function(a){angular.copy(a.data,c)})};return{upsertComment:h,getSubmissions:f,getSubmission:g,submissions:d,submission:e,updateVotes:i}}]),function(a){"use strict";function b(b,c,d,e,f,g,h){function i(){b.$modalInstance=d.open({templateUrl:"scripts/admin/users/users.image-upload.modal/users.image-upload.modal.html",controller:"UsersImageUploadModalController",controllerAs:"usersImageUploadModalCtrl",windowClass:"app-modal-window",size:"lg",resolve:{images:function(){return j.user.images},userId:function(){return j.user.id}}}),b.$modalInstance.result.then(function(a){j.user.profile_image=a,j.upsertUser(j.user)})}var j=this;j.master={},j.getUsers=function(){h.getUsers().then(function(){j.users=h.users})},j.getUser=function(){h.getUser(f.user).then(function(){j.user=h.user,a.copy(j.user,j.master)})},j.getProfile=function(){g.setUser().then(function(){c.session=g.session,h.getProfile(c.session).then(function(){j.user=h.profile,a.copy(j.user,j.master)})})},j.upsertUser=function(b){g.isAuthenticated()&&!a.equals(j.user,j.master)&&h.upsertUser(b).then(function(){toastr.success("User updated successfully","Done")})},j.deleteUser=function(a,b){g.isAuthenticated()&&h.deleteUser(a,b)},j.resetUser=function(){b.user=b.master,toastr.info("User reset to last save","Done")},b.selectedUser=function(a){a&&b.$emit("selectedUser",a.originalObject)},b.exclude=function(a){return!a.role.match(/^(admin|editor)$/)},b.select=function(b){a.element(b.target).hasClass("active")?a.element(b.target).removeClass("active"):a.element(b.target).addClass("active"),a.element(b.target).siblings().removeClass("active")},j.openImageUploadModal=i}a.module("lematClient.admin.users").controller("UsersController",b),b.$inject=["$scope","$rootScope","$uibModal","$location","$stateParams","AuthFactory","UsersFactory"]}(angular),function(a){"use strict";function b(b,c,d,e,f,g,h){var i=this;i.image={},i.images=g,i.profileImage="",console.log(g),i.uploadImage=function(){var b={user_id:h,image_url:i.profileImage};f.uploadImage(b),a.copy(b,i.image),i.images.push(b)},b.ok=function(){e.close(i.profileImage)},b.cancel=function(){e.dismiss("cancel")}}a.module("lematClient.admin.users").controller("UsersImageUploadModalController",b),b.$inject=["$scope","$rootScope","$uibModal","$modalInstance","ImagesFactory","images","userId"]}(angular),function(a){"use strict";function b(a,b,c,d){var e=this;e.getUsers=function(){d.getUsers().then(function(){e.users=d.users})},a.exclude=function(a){return!a.role.match(/^(admin|editor)$/)}}a.module("lematClient.core.editors").controller("EditorsController",b),b.$inject=["$scope","$location","AuthFactory","UsersFactory"]}(angular),function(a){"use strict";function b(a){var b=this;a.getPostUsers().then(function(){b.postUsers=a.postUsers}),a.getIssueUsers().then(function(){b.issueUsers=a.issueUsers})}a.module("lematClient.core.layout.footer").controller("FooterController",b),b.$inject=["UsersFactory"]}(angular),function(a){"use strict";function b(a,b,c,d,e,f,g){var h=this;h.url=b.absUrl(),h.identifier=d.entry,h.getEntries=function(){e.getEntries().then(function(){h.entries=e.entries,h.entry=c("orderBy")(e.entries,"-created_at")[0]})},h.getEntry=function(){e.getEntry(d.entry),h.entry=e.entry},h.getIssues=function(){f.getIssues(),h.issues=f.issues},h.getPosts=function(){g.getPosts().then(function(){h.posts=g.posts})},a.pageChangeHandler=function(a){console.log("going to page "+a)},a.currentPage=1}a.module("lematClient.core.entries").controller("EntriesController",b),b.$inject=["$scope","$location","$filter","$stateParams","EntryFactory","IssuesFactory","PostsFactory"]}(angular),function(a){"use strict";function b(a,b,c,d,e){var f=this;f.url=c.absUrl(),f.isAuthenticated=function(){return e.isAuthenticated()},f.logout=function(){e.logout(),b.session={}},f.getUserName=function(){b.userName=e.getUserName()},f.isAdmin=function(){return e.isAdmin()},a.$on("scroll",function(b,c){a.title=c}),a.$on("$locationChangeStart",function(){"/issue/:id"!==c.url()&&(a.title="")}),a.scrollShow=function(){return"/issue/1"===c.url()},b.filters={},b.setFilter=function(a){b.filters.tags=a,c.path("/online")}}a.module("lematClient.core.layout.header").controller("NavController",b),b.$inject=["$scope","$rootScope","$location","$http","AuthFactory"]}(angular),function(a){"use strict";function b(a,b){}a.module("lematClient.core.layout.logo").controller("LogoController",b),b.$inject=["$scope","$timeout"]}(angular),function(a){"use strict";function b(a,b,c,d,e,f,g,h,i,j,k){var l=this;l.title="",l.scrollToTop=function(){e.scrollTopAnimated(0)},l.getIssues=function(){j.getIssues(),l.issues=j.issues},l.getIssue=function(){j.getIssue(c.id).then(function(){l.issue=j.issue})},l.getPiece=function(){k.getPiece(c.id,c.piece).then(function(){l.piece=k.piece})},l.exclude=function(a){return a.role.includes("contributor")}}a.module("lematClient.core.issues").controller("IssuesController",b),b.$inject=["$scope","$rootScope","$stateParams","$location","$document","$http","$uibModal","AuthFactory","AS3Factory","IssuesFactory","PiecesFactory"]}(angular),function(a){"use strict";function b(a,b,c,d){var e=this;e.getPost=function(){d.getPost(c.post).then(function(){e.post=d.post})},e.getPosts=function(){d.getPosts().then(function(){e.posts=d.posts})},a.popover={templateUrl:"tag-popover.template.html"}}a.module("lematClient.core.posts").controller("PostsController",b),b.$inject=["$scope","$location","$stateParams","PostsFactory"]}(angular),function(a){"use strict";function b(a,b,c,d){var e=this;b.session=d.setUser(),b.userId=d.session.id,e.postCredentials=function(a){d.login(a).then(function(){b.session=d.setUser(),b.userId=d.session.id,c.path("/")}),toastr.success("Logged in","Done")}}a.module("lematClient.core.login").controller("LoginController",b),b.$inject=["$scope","$rootScope","$location","AuthFactory"]}(angular),function(a){"use strict";function b(b,c,d,e,f,g,h){function i(){j.$modalInstance=d.open({templateUrl:"core/profile/profile-modal/profile.image-upload.html",controller:"ProfileModalController",controllerAs:"profileModalCtrl",windowClass:"app-modal-window",size:"lg",resolve:{images:function(){return j.user.images},userId:function(){return j.user.id}}}),j.$modalInstance.result.then(function(a){j.profile.profile_image=a,j.upsertUser(j.user)})}var j=this;j.master={},j.getProfile=function(){h.getUser(f.profile).then(function(){j.user=h.user})},j.getUserProfile=function(){g.setUser().then(function(){c.session=g.session,h.getProfile(c.session).then(function(){j.user=h.profile,a.copy(j.user,j.master)})})},j.upsertProfile=function(b){g.isAuthenticated()&&!a.equals(j.user,j.master)&&h.upsertUser(b).then(function(){toastr.success("User updated successfully","Done")})},j.resetProfile=function(){b.user=b.master,toastr.info("User reset to last save","Done")},j.openImageUploadModal=i,j.fields={},j.save=function(a,b,c){j.fields[b]=!j.fields[b],j.upsertProfile(c),toastr.success("User updated successfully","Done")},j.reset=function(a){27===a.keyCode&&j.userForm.$rollbackViewValue()},b.popover={templateUrl:"popoverTemplate.html"}}a.module("lematClient.core.profile").controller("ProfileController",b),b.$inject=["$scope","$rootScope","$uibModal","$location","$stateParams","AuthFactory","UsersFactory"]}(angular),function(a){"use strict";function b(){function a(a,b){b.bind("change",function(b){var c=b.target.files,d=c[0];a.file=d,a.$parent.file=d,a.$apply()})}var b={restrict:"AE",scope:{file:"@"},link:a};return b}a.module("lematClient.common.directives").directive("file",b)}(angular),function(a){"use strict";function b(a,b,c){function d(d,e,f,g){d.uploadFile=function(b,e){var f=a.defer();return f.resolve(c.uploadFile(b,e).then(function(a){var b="https://lematjournal.s3.amazonaws.com/"+a.params.Key;d.filename=b})),f.promise},e.bind("change",function(a){var c=a.target.files,e=c[0];d.file=e,d.uploadFile(d.file,d.folder,d.uploadAction).then(function(){console.log(d.filename),b(function(){g.$setViewValue(d.filename)},1e3).then(function(){d.uploadAction&&d.uploadAction()})})})}var e={restrict:"AE",require:"ngModel",scope:{folder:"=",uploadAction:"="},link:d};return e}a.module("lematClient.common.directives").directive("fileSelect",b),b.$inject=["$q","$timeout","AS3Factory"]}(angular),function(a){"use strict";function b(){function b(b,c){c.bind("click",function(b){a.element(b.target).siblings("#upload").trigger("click")})}var c={restrict:"A",link:b};return c}a.module("lematClient.common.directives").directive("uploadfile",b)}(angular),function(a){"use strict";function b(){var b=function(b,c){a.element(c),b.$last&&setTimeout(function(){b.$emit("lastElem")},1)};return b}a.module("lematClient.common.directives").directive("lematRepeat",b)}(angular),function(a){"use strict";function b(a){function b(b,c){b.isLoading=function(){return a.pendingRequests.length>0},b.$watch(b.isLoading,function(a){a?c.show():c.hide()})}var c={restrict:"A",link:b};return c}a.module("lematClient.common.directives").directive("lematLoading",b),b.$inject=["$http"]}(angular),function(a){"use strict";function b(){var a=function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})};return a}a.module("lematClient.common.directives").directive("ngEnter",b)}(angular),function(a){"use strict";function b(){var a=function(a,b,c){b.bind("keydown keypress",function(b){27===b.which&&(a.$apply(function(){a.$eval(c.ngEsc)}),b.preventDefault())})};return a}a.module("lematClient.common.directives").directive("ngEsc",b)}(angular),function(a){"use strict";function b(b){function c(c){var d=[];c.$on("lastElem",function(){a.forEach(c.vm.issue.pieces,function(a){var b="#"+a.title_url.toString(),c=document.querySelector(b),e=c.getBoundingClientRect().top;d.push({title:a.title,pos:e})}),d.sort(function(a,b){return parseFloat(a.pos-b.pos)})});var e=0;b.on("scroll",function(){try{c.scroll<d[0].pos&&(c.title="")}catch(a){}try{c.scroll>d[e].pos&&c.scroll>d[0].pos&&(c.vm.title=d[e].title)}catch(a){}try{c.scroll>d[e+1].pos&&e++}catch(a){}try{c.scroll<d[e].pos&&c.scroll>d[0].pos&&e--}catch(a){}c.$emit("scroll",c.vm.title.toUpperCase())})}var d={scope:!1,controller:"IssuesController",controllerAs:"vm",bindToController:!0,link:c};return d}a.module("lematClient.common.directives").directive("scroll",b),b.$inject=["$document"]}(angular),function(a){"use strict";function b(b){function c(c,d){var e=a.element(b),f=function(){c.scroll=e.scrollTop()};e.on("scroll",c.$apply.bind(c,f)),f()}var d={scope:{scroll:"=scrollPosition"},link:c};return d}a.module("lematClient.common.directives").directive("scrollPosition",b),b.$inject=["$document"]}(angular),function(a){"use strict";function b(b,c,d){var e={},f=function(){return b.get(d+"/amazon/sign_key").then(function(b){a.copy(b.data,e)})},g=function(a,b){var d=c.defer();return f().then(function(){var c=new AWS.S3({region:"us-east-1",credentials:new AWS.Credentials(e.access_key,e.secret_key)});if(a){var f=i()+"-"+a.name,g={Bucket:"lematjournal",Key:b+f,ContentType:a.type,Body:a,ServerSideEncryption:"AES256"};d.resolve(c.putObject(g,function(a,b){return a?!1:!0}))}else console.log("Please select a file to upload")}),d.promise},h=function(a){console.log(a);var b=c.defer();return f().then(function(){var c=new AWS.S3({region:"us-east-1",credentials:new AWS.Credentials(e.access_key,e.secret_key)});a=a.replace("https://lematjournal.s3.amazonaws.com/",""),console.log(a);var d={Bucket:"lematjournal",Key:a};b.resolve(c.deleteObject(d,function(a,b){a&&console.log(a,a.stack)}))}),b.promise},i=function(){for(var a="",b="abcdefghijklmnopqrstuvwxyz0123456789",c=0;16>c;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a};return{getKeys:f,uploadFile:g,deleteFile:h,keys:e}}a.module("lematClient.common.factories").factory("AS3Factory",b),b.$inject=["$http","$q","ServerUrl"]}(angular),function(a){"use strict";function b(b,c,d,e){var f={},g={},h=function(a){return b.post(e+"/users/login",a).then(function(a){f=a.id,o(a)})},i=function(){return b.post(e+"/users/logout").then(function(){d.localStorage.removeItem("lemat-user"),f={},console.log("logged out")})},j=function(a){var c={user:{email:a.email,password:a.password}};return b.post(e+"/users/",c).then(function(a){o(a)},function(a){console.log(a)})},k=function(){var a=JSON.parse(d.localStorage.getItem("lemat-user"));return a?!0:!1},l=function(){if(d.localStorage.getItem("lemat-user")){var a=JSON.parse(d.localStorage.getItem("lemat-user"));return"admin"===a.data.role?!0:!1}},m=function(){if(k()){var a=JSON.parse(d.localStorage.getItem("lemat-user"));return a.data.role}return"user"},n=function(){var b=c.defer();if(d.localStorage.getItem("lemat-user")){var e=JSON.parse(d.localStorage.getItem("lemat-user")),e={id:e.data.id,email:e.data.email,username:e.data.username,role:e.data.role};b.resolve(a.copy(e,g))}return b.promise},o=function(a){d.localStorage.setItem("lemat-user",JSON.stringify(a)),(a.data.role="admin")&&(b.defaults.headers.common.Authorization="Token token="+a.data.token,console.log(a.data.token))};return{login:h,logout:i,register:j,isAuthenticated:k,isAdmin:l,getUserRole:m,setUser:n,session:g}}a.module("lematClient.common.factories").factory("AuthFactory",b),b.$inject=["$http","$q","$window","ServerUrl"]}(angular),angular.module("lematClient.common.factories").factory("EntryFactory",["$http","$window","AuthFactory","ServerUrl","Slug",function(a,b,c,d,e){var f={},g=[],h=function(){return a.get(d+"/news/entries/").then(function(a){angular.copy(a.data,g)})},i=function(b){return a.get(d+"/news/entries/"+b).then(function(a){angular.copy(a.data,f)})},j=function(b){var c={entry:{title:b.title,content:b.content,user_id:b.user_id,image_url:b.image_url,title_url:e.slugify(b.title),preview:m(b.content)}};return b.id?a.patch(d+"/news/entries/"+b.id,c).then(function(a){console.log("response: ",a)},function(a){console.log(a)}):a.post(d+"/news/entries/",c).then(function(a){console.log("response: ",a),i(a.data.id)},function(a){console.log("response: ",a)})},k=function(b){return a["delete"](d+"/news/entries/"+b).then(function(){g.splice(l(b),1)})},l=function(a){for(var b=0;b<f.length;b++)if(f[b].id===a)return b},m=function(a){for(var b=a,c=[],d=0;d<b.length;d++)"</div>"===b[d]&&c.push(d);console.log(a),console.log(c)};return{getEntries:h,getEntry:i,upsertEntry:j,deleteEntry:k,entry:f,entries:g}}]),angular.module("lematClient.common.factories").factory("IssuesFactory",["$http","$window","ServerUrl",function(a,b,c){var d=[],e={},f=[],g=function(){angular.copy({},e)},h=function(){return a.get(c+"/content/issues/").then(function(a){angular.copy(a.data,d)})},i=function(b){return a.get(c+"/content/issues/"+b).then(function(a){angular.copy(a.data,e)})},j=function(b){var e={issue:{title:b.title,image_url:b.image_url,download_link:b.download_link}};return console.log(b),b.id?a.patch(c+"/content/issues/"+b.id,e).then(function(a){i(a.data.id)},function(a){console.log(a)}):a.post(c+"/content/issues/",e).then(function(a){d.push(a.data)},function(a){console.log("response: ",a)})},k=function(b,e){return a["delete"](c+"/content/issues/"+e).then(function(){d.splice(l(b),1)})},l=function(a){for(var b=0;b<e.length;b++)if(d[b].id===a)return b},m=function(b){return a.get(c+"/content/issues/"+b+"/pieces").then(function(a){angular.copy(a.data,f)})},n=function(b){var d={image:{image_url:b.imageUrl,user_id:b.userId,issue_id:b.issueId}};return a.post(c+"/content/images/",d).then(function(a){angular.copy(a.data,b)},function(a){console.log("error: ",a)})};return{getIssues:h,getIssue:i,getIssuePieces:m,issues:d,issue:e,pieces:f,upsertIssue:j,deleteIssue:k,resetIssue:g,uploadIssueImage:n}}]),angular.module("lematClient.common.factories").factory("SecFactory",["$rootScope","$location","AuthFactory",function(a,b,c){var d={admin:3,editor:2,author:1,contributor:1,user:0},e={},f={},g=function(){var a=c.getUserRole();return"admin"===a?e=3:"editor"===a?e=2:"author"===a?e=1:"contributor"===a?e=1:"user"===a&&(e=0),e},h=function(a){"admin"===a?this.role=d.admin:"editor"===a?this.role=d.editor:"author"===a?this.role=d.author:"contributor"===a?this.role=d.contributor:this.role=d.user};h.prototype.getLevel=function(){return this.role};var i=function(a){f=new h(a),j()},j=function(){var a=!1;a=g()>=f.getLevel()?!0:!1,a||b.path("/")};return{roles:d,clearance:e,setPermission:i,getPermission:j,permission:f,permissionLevel:h,permissionCheck:g}}]),angular.module("lematClient.common.factories").factory("PiecesFactory",["$http","$window","ServerUrl","Slug",function(a,b,c,d){var e={},f=function(b,d){return a.get(c+"/content/issues/"+b+"/pieces/"+d).then(function(a){angular.copy(a.data,e)})},g=function(b,e){var f=[];b.users&&b.users.map(function(a){console.log(a),f.push(a.id)});var g={piece:{title:b.title,content:b.content,piece_type:b.piece_type,user_ids:f,issue_id:e,order:b.order,title_url:d.slugify(b.title)}};return b.id?a.patch(c+"/content/issues/"+b.issue_id+"/pieces/"+b.id,g).then(function(a){pieces.push(a.data)},function(a){console.log(a)}):a.post(c+"/content/issues/"+e+"/pieces/",g).then(function(a){console.log("error: ",a)})},h=function(b){return a["delete"](c+"/content/issues/"+b.issue_id+"/pieces/"+b.id).then(function(a){console.log("response: ",a)})};return{getPiece:f,upsertPiece:g,deletePiece:h,piece:e}}]),angular.module("lematClient.common.factories").factory("PostsFactory",["$http","AuthFactory","ServerUrl",function(a,b,c){var d=[],e={},f=[],g=function(){angular.copy({},e)},h=function(){return a.get(c+"/content/posts/").then(function(a){angular.copy(a.data,d)})},i=function(b){return a.get(c+"/content/posts/"+b).then(function(a){angular.copy(a.data,e),console.log(e)})},j=function(){return a.get(c+"/content/tags/").then(function(a){angular.copy(a.data,f),console.log(a.data)})},k=function(b){var d={post:{title:b.title,tag_names:b.tags,user_id:b.user_id,content:b.content,post_type:b.post_type,preview:b.preview,title_url:b.title_url}};return console.log(d),b.id?a.patch(c+"/content/posts/"+b.id,d).then(function(a){console.log(a)}):a.post(c+"/content/posts/",d).then(function(a){console.log(a)})},l=function(a){for(var b=0;b<d.length;b++)if(d[b].id===a)return b},m=function(b){return a["delete"](c+"/content/posts/"+b).then(function(){d.splice(l(b),1)})};return{getPosts:h,getPost:i,getTags:j,posts:d,post:e,tags:f,upsertPost:k,deletePost:m,resetPost:g}}]),angular.module("lematClient.common.factories").factory("UsersFactory",["$http","AuthFactory","ServerUrl",function(a,b,c){var d=[],e=[],f={},g=[],h={},i=[],j=function(b){return a.get(c+"/users/"+b).then(function(a){angular.copy(a.data,f)})},k=function(){return a.get(c+"/users/").then(function(a){angular.copy(a.data,e)})},l=function(){return a.get(c+"/users/post-users").then(function(a){angular.copy(a.data,g)})},m=function(){return a.get(c+"/users/issue-users").then(function(a){angular.copy(a.data,i)})},n=function(){return a.get(c+"/users/editors").then(function(a){angular.copy(a.data,d)})},o=function(b){var d={user:{email:b.email,username:b.username.replace(/[^\w\s]/gi,""),role:b.role,bio:b.bio,password:b.password,profile_image:b.profile_image,social_links:b.social_links}};return b.id?a.patch(c+"/users/"+b.id,d).then(function(a){angular.copy(a.data,b),e.push(a.data),k()}):a.post(c+"/users/",d).then(function(a){angular.copy(a.data,b),e.push(a.data),k()})},p=function(a){for(var b=0;b<e.length;b++)if(e[b].id===a)return b},q=function(b,d){return a["delete"](c+"/users/"+d).then(function(){e.splice(p(b),1)})},r=function(b){return a.get(c+"/users/profiles/"+b.id).then(function(a){angular.copy(a.data,h)})};return{getEditors:n,getUser:j,getUsers:k,getPostUsers:l,getIssueUsers:m,getProfile:r,upsertUser:o,deleteUser:q,editors:d,user:f,users:e,profile:h,postUsers:g,issueUsers:i}}]),angular.module("lematClient.common.filters").filter("to_trusted",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),angular.module("lematClient.common.filters").filter("escapeHtml",function(){var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return function(b){return String(b).replace(/[&<>"'\/]/g,function(b){return a[b]})}}),angular.module("lematClient.common.filters").filter("spaceless",function(){return function(a){return a?a.replace(/[()&<>"'\/]/g,"").replace(/\s+/g,"-"):void 0}}),angular.module("lematClient.common.filters").filter("cut",function(){return function(a,b,c,d){if(!a)return"";if(c=parseInt(c,10),!c)return a;if(a.length<=c)return a;if(a=a.substr(0,c),b){var e=a.lastIndexOf(" ");-1!==e&&(a=a.substr(0,e))}return a+(d||"…")}}),function(){"use strict";angular.module("bootstrapColumnsSameHeight",[]).directive("sameHeight",["$window",function(a){var b=function(a){var b=0;angular.forEach(a,function(a){a.style.minHeight="0px",a.offsetHeight>b&&(b=a.offsetHeight,console.log("tallest col: ",b))}),angular.forEach(a,function(a){a.style.minHeight=b+"px"})},c=function(a){var b=a.children(),c=[],d=function(a){var b=/col-xs-([0-9]{1,2})/.exec(a);return b?parseInt(b[1],10):0},e=function(a){var b=/col-sm-([0-9]{1,2})/.exec(a);return b?parseInt(b[1],10):d(a)},f=function(a){var b=/col-md-([0-9]{1,2})/.exec(a);return b?parseInt(b[1],10):e(a)},g=function(a){var b=/col-lg-([0-9]{1,2})/.exec(a);return b?parseInt(b[1],10):f(a);
};return angular.forEach(b,function(a){var b=angular.element(a).attr("class");c.push({xs:d(b),sm:e(b),md:f(b),lg:g(b)})}),c},d=function(){return a.innerWidth<768?"xs":a.innerWidth>=768&&a.innerWidth<992?"sm":a.innerWidth>=992&&a.innerWidth<1200?"md":"lg"},e=function(a){var e=c(a),f=a.children(),g=[],h=0,i=[];angular.forEach(e,function(a,b){h+a[d()]<=12?(i.push(f[b]),h+=a[d()]):(g.push(i),i=[],i.push(f[b]),h=a[d()])}),i.length>0&&g.push(i),angular.forEach(g,function(a){b(a)})};return{restrict:"EA",link:function(b,c){b.$on("lastElem",function(){e(c)}),angular.element(a).bind("resize",function(){e(c)})}}}])}(),function(a){"use strict";a.module("lematClient").config(["$stateProvider","$modalStateProvider","$urlRouterProvider",function(a,b,c){a.state("admin",{url:"/admin",views:{"@":{templateUrl:"scripts/admin/admin.html"},"nav@":{templateUrl:"scripts/admin/layout/nav/nav.html"},"footer@":{templateUrl:"scripts/core/layout/footer/footer.html",controller:"FooterController",controllerAs:"footerCtrl"}}}).state("admin.entries",{url:"/entries",templateUrl:"scripts/admin/entries/entries.html",controller:"EntriesAdminController",controllerAs:"entriesAdminCtrl"}).state("admin.entries-create",{url:"/entries/create",templateUrl:"scripts/admin/entries/entries.create/entries.create.html",controller:"EntriesAdminController",controllerAs:"entriesAdminCtrl"}).state("admin.entries-edit",{url:"/entries/:entry/edit",templateUrl:"scripts/admin/entries/entries.edit/entries.edit.html",controller:"EntriesAdminController",controllerAs:"entriesAdminCtrl"}).state("admin.images",{url:"/images",templateUrl:"scripts/admin/images/images.html",controller:"ImagesController",controllerAs:"imagesCtrl"}).state("admin.issues",{url:"/issues",templateUrl:"scripts/admin/issues/issues.html",controller:"IssuesAdminController",controllerAs:"issuesAdminCtrl"}).state("admin.issues-create",{url:"/issues/create",templateUrl:"scripts/admin/issues/issues.create/issues.create.html",controller:"IssuesAdminController",controllerAs:"issuesAdminCtrl"}).state("admin.issues-edit",{url:"/issues/:id/edit",templateUrl:"scripts/admin/issues/issues.edit/issues.edit.html",controller:"IssuesAdminController",controllerAs:"issuesAdminCtrl"}).state("admin.issues-edit-piece",{url:"/issues/:id/edit/:piece",templateUrl:"scripts/admin/issues/pieces/pieces.edit/pieces.edit.html",controller:"PiecesAdminController",controllerAs:"piecesAdminCtrl"}).state("admin.mail",{url:"/mail",templateUrl:"scripts/admin/mail/mail.html",controller:"MailController",controllerAs:"mailCtrl"}).state("admin.mail-detail",{url:"mail/:mail",templateUrl:"scripts/admin/mail/mail.detail/mail.detail.html",controller:"MailController",controllerAs:"mailCtrl"}).state("admin.posts",{url:"/posts",templateUrl:"scripts/admin/posts/posts.html",controller:"PostsAdminController",controllerAs:"postsAdminCtrl"}).state("admin.posts-create",{url:"posts/create",templateUrl:"scripts/admin/posts/posts.create/posts.create.html",controller:"PostsAdminController",controllerAs:"postsAdminCtrl"}).state("admin.posts-edit",{url:"posts/:post/edit",templateUrl:"scripts/admin/posts/posts.edit/posts.edit.html",controller:"PostsAdminController",controllerAs:"postsAdminCtrl"}).state("admin.submissions",{url:"/submissions",templateUrl:"scripts/admin/submissions/submissions.html",controller:"SubmissionsController",controllerAs:"submissionsCtrl"}).state("admin.users",{url:"/users",templateUrl:"scripts/admin/users/users.html",controller:"UsersController",controllerAs:"usersCtrl"}).state("admin.users-create",{url:"/users/create",templateUrl:"scripts/admin/users/users.create/users.create.html",controller:"UsersController",controllerAs:"usersCtrl"}).state("admin.users-edit",{url:"/users/:user/edit",templateUrl:"scripts/admin/users/users.edit/users.edit.html",controller:"UsersController",controllerAs:"usersCtrl"})}])}(angular),function(a){"use strict";a.module("lematClient").config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("root",{"abstract":!0,views:{"@":{},"footer@":{templateUrl:"scripts/core/layout/footer/footer.html",controller:"FooterController",controllerAs:"footerCtrl"},"nav@":{templateUrl:"scripts/core/layout/nav/nav.html",controller:"NavController",controllerAs:"navCtrl"}}}).state("main",{url:"/",views:{"@":{templateUrl:"scripts/core/entries/entries.html",controller:"EntriesController",controllerAs:"entriesCtrl"},"logo@":{templateUrl:"scripts/core/layout/logo/logo.html",controller:"LogoController"}},parent:"root"}).state("main.entries-detail",{url:"news/:entry",views:{"@":{templateUrl:"scripts/core/entries/entries.detail/entries.detail.html",controller:"EntriesController",controllerAs:"entriesCtrl"},"logo@":{}}}).state("main.issues",{url:"issues",views:{"@":{templateUrl:"scripts/core/issues/issues.html",controller:"IssuesController",controllerAs:"issuesCtrl"},"logo@":{}}}).state("main.issues-detail",{url:"issues/:id",views:{"@":{templateUrl:"scripts/core/issues/issues.detail/issues.detail.html",controller:"IssuesController",controllerAs:"issuesCtrl"},"logo@":{}}}).state("main.issues-detail-piece",{url:"issues/:id/:piece",views:{"@":{templateUrl:"scripts/core/issues/issues.detail/piece.html",controller:"IssuesController",controllerAs:"issuesCtrl"},"logo@":{}}}).state("main.posts",{url:"online",views:{"@":{templateUrl:"scripts/core/posts/posts.html",controller:"PostsController",controllerAs:"postsCtrl"},"logo@":{}}}).state("main.posts-detail",{url:"online/:post",views:{"@":{templateUrl:"scripts/core/posts/posts.detail/posts.detail.html",controller:"PostsController",controllerAs:"postsCtrl"}}}).state("main.profile",{url:"profile",views:{"@":{templateUrl:"scripts/core/profile/profile.html",controller:"ProfileController",controllerAs:"profileCtrl"}}}).state("main.profile-detail",{url:"profile/:profile",views:{"@":{templateUrl:"scripts/core/profile/profile.detail/profile.detail.html",controller:"ProfileController",controllerAs:"profileCtrl"}}}).state("main.editors",{url:"editors",views:{"@":{templateUrl:"scripts/core/editors/editors.html",controller:"EditorsController",controllerAs:"editorsCtrl"},"logo@":{}}}).state("main.login",{url:"login",views:{"@":{templateUrl:"scripts/core/login/login.html",controller:"LoginController",controllerAs:"loginCtrl"},"logo@":{}}}).state("main.submissions",{url:"submissions",views:{"@":{templateUrl:"scripts/core/submissions/submissions.html"},"logo@":{}}}).state("main.about",{url:"about",views:{"@":{templateUrl:"scripts/core/about/about.html"},"logo@":{}}})}]),a.module("lematClient").run(["$rootScope","$log",function(a,b){a.$on("$stateChangeSuccess",function(a,c,d,e,f){b.debug("successfully changed states"),b.debug("event",a),b.debug("toState",c),b.debug("toParams",d),b.debug("fromState",e),b.debug("fromParams",f)}),a.$on("$stateNotFound",function(a,c,d,e){b.error("The requested state was not found: ",c)}),a.$on("$stateChangeError",function(a,c,d,e,f,g){b.error("An error occured while changing states: ",g),b.debug("event",a),b.debug("toState",c),b.debug("toParams",d),b.debug("fromState",e),b.debug("fromParams",f)})}])}(angular),function(a){"use strict";a.module("lematClient").provider("$modalState",["$stateProvider",function(a){var b=this;this.$get=function(){return b},this.state=function(b,c){var d;a.state(b,{url:c.url,onEnter:["$modal","$state",function(a,e){d=a.open(c),d.result["finally"](function(){d=null,e.$current.name===b&&e.go("^")})}],onExit:function(){d&&d.close()}})}}])}(angular);